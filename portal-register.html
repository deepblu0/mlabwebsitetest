<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kayıt Ol | M-LAB Portal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        mlab: {
                            navy: '#0a192f',
                            cyan: '#00d4ff',
                            purple: '#7c3aed',
                            dark: '#0f172a',
                            orange: '#ff7e67',
                            teal: '#0d9488'
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .coin-flip-container {
            perspective: 1000px;
        }

        .coin-flip {
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
        }

        .coin-flip:hover {
            transform: rotateY(360deg);
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 antialiased min-h-screen flex flex-col">

    <!-- NAVBAR -->
    <nav id="navbar" class="fixed top-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-xl border-b border-slate-200/50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <a href="/" class="flex items-center gap-3 group">
                    <img src="mlab-logo.png" alt="M-LAB"
                        class="h-12 w-auto transition-transform duration-300 group-hover:scale-105">
                </a>
                <div class="hidden lg:flex items-center gap-1">
                    <a href="sehirler-misyonu"
                        class="nav-link relative px-4 py-2 text-slate-600 hover:text-mlab-navy transition-colors text-sm font-medium group">Şehirler
                        Misyonu</a>
                    <a href="buyukzorluklar"
                        class="nav-link relative px-4 py-2 text-slate-600 hover:text-mlab-navy transition-colors text-sm font-medium group">
                        Büyük Zorluklar
                        <span
                            class="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-gradient-to-r from-mlab-cyan to-mlab-purple transition-all duration-300 group-hover:w-3/4"></span>
                    </a>
                    <a href="ufuk-hibeleri"
                        class="nav-link relative px-4 py-2 text-slate-600 hover:text-mlab-navy transition-colors text-sm font-medium group">Ufuk
                        Hibeleri</a>
                    <a href="projeler"
                        class="nav-link relative px-4 py-2 text-slate-600 hover:text-mlab-navy transition-colors text-sm font-medium group">Projeler</a>
                    <a href="dokumanlar"
                        class="nav-link relative px-4 py-2 text-slate-600 hover:text-mlab-navy transition-colors text-sm font-medium group">Dokümanlar</a>
                    <a href="analizler"
                        class="nav-link relative px-4 py-2 text-slate-600 hover:text-mlab-navy transition-colors text-sm font-medium group">Analizler</a>
                    <a href="iletisim"
                        class="nav-link relative px-4 py-2 text-slate-600 hover:text-mlab-navy transition-colors text-sm font-medium group">İletişim</a>
                    <a href="portal"
                        class="ml-2 px-5 py-2.5 bg-gradient-to-r from-mlab-navy to-mlab-purple text-white text-sm font-semibold rounded-full shadow-lg shadow-mlab-purple/25">Portal</a>
                </div>
                <button id="mobile-menu-btn"
                    class="lg:hidden p-2.5 text-slate-600 hover:text-mlab-navy hover:bg-slate-100 rounded-xl">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="h-20"></div>

    <!-- REGISTRATION FORM -->
    <section class="flex-grow py-12 lg:py-20">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="max-w-2xl mx-auto">
                <!-- Header -->
                <div class="text-center mb-10">
                    <a href="portal"
                        class="inline-flex items-center gap-2 text-mlab-purple hover:text-mlab-navy transition-colors mb-4">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i>
                        Portal'a Dön
                    </a>
                    <h1 class="text-3xl md:text-4xl font-bold text-mlab-navy mb-3">Platforma Kayıt Ol</h1>
                    <p class="text-slate-600">Bilgilerinizi doldurun ve onay sürecini başlatın.</p>
                </div>

                <!-- Form Card -->
                <div class="bg-white rounded-3xl shadow-xl p-8 lg:p-10">
                    <form id="register-form" class="space-y-6">

                        <!-- Category Selection -->
                        <div>
                            <label class="block text-sm font-semibold text-mlab-navy mb-3">Kurum Kategorisi *</label>
                            <div class="grid grid-cols-2 gap-4">
                                <label class="relative cursor-pointer">
                                    <input type="radio" name="category" value="belediye" class="peer sr-only" required>
                                    <div
                                        class="p-4 rounded-xl border-2 border-slate-200 peer-checked:border-mlab-purple peer-checked:bg-mlab-purple/5 transition-all hover:border-slate-300">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-lg bg-mlab-navy/10 flex items-center justify-center">
                                                <i data-lucide="landmark" class="w-5 h-5 text-mlab-navy"></i>
                                            </div>
                                            <div class="font-semibold text-mlab-navy">Belediye</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative cursor-pointer">
                                    <input type="radio" name="category" value="ozel_sektor" class="peer sr-only"
                                        required>
                                    <div
                                        class="p-4 rounded-xl border-2 border-slate-200 peer-checked:border-mlab-orange peer-checked:bg-mlab-orange/5 transition-all hover:border-slate-300">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-lg bg-mlab-orange/10 flex items-center justify-center">
                                                <i data-lucide="building-2" class="w-5 h-5 text-mlab-orange"></i>
                                            </div>
                                            <div class="font-semibold text-mlab-navy">Özel Sektör</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <hr class="border-slate-100">

                        <!-- Organization Info -->
                        <div class="space-y-4">
                            <h3 class="font-semibold text-mlab-navy flex items-center gap-2">
                                <i data-lucide="building" class="w-4 h-4"></i>
                                Kurum Bilgileri
                            </h3>

                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Kurum Adı *</label>
                                <input type="text" name="org_name" required
                                    class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-slate-800 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-mlab-cyan/50 focus:border-mlab-cyan transition-all">
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-slate-700 mb-2">Web Sitesi</label>
                                    <input type="text" name="website"
                                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-slate-800 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-mlab-cyan/50 focus:border-mlab-cyan transition-all">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Kurum Açıklaması</label>
                                <textarea name="org_description" rows="3"
                                    class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-slate-800 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-mlab-cyan/50 focus:border-mlab-cyan transition-all resize-none"></textarea>
                            </div>

                            <!-- Büyük Zorluklar -->
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-3">Kurumunuz hangi Büyük
                                    Zorluklar kapsamında katkı sunabilir? *</label>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                    <label
                                        class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 cursor-pointer transition">
                                        <input type="checkbox" name="challenges" value="barinma"
                                            class="w-4 h-4 rounded text-mlab-cyan focus:ring-mlab-cyan/50">
                                        <span class="text-sm text-slate-700">Uygun Fiyatlı Barınma</span>
                                    </label>
                                    <label
                                        class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 cursor-pointer transition">
                                        <input type="checkbox" name="challenges" value="hareketlilik"
                                            class="w-4 h-4 rounded text-mlab-cyan focus:ring-mlab-cyan/50">
                                        <span class="text-sm text-slate-700">Sürdürülebilir Hareketlilik</span>
                                    </label>
                                    <label
                                        class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 cursor-pointer transition">
                                        <input type="checkbox" name="challenges" value="afet"
                                            class="w-4 h-4 rounded text-mlab-cyan focus:ring-mlab-cyan/50">
                                        <span class="text-sm text-slate-700">Afetlere Dirençlilik</span>
                                    </label>
                                    <label
                                        class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 cursor-pointer transition">
                                        <input type="checkbox" name="challenges" value="gida"
                                            class="w-4 h-4 rounded text-mlab-cyan focus:ring-mlab-cyan/50">
                                        <span class="text-sm text-slate-700">Sağlıklı Gıda</span>
                                    </label>
                                    <label
                                        class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 cursor-pointer transition">
                                        <input type="checkbox" name="challenges" value="saglik"
                                            class="w-4 h-4 rounded text-mlab-cyan focus:ring-mlab-cyan/50">
                                        <span class="text-sm text-slate-700">Sağlık ve Esenlik</span>
                                    </label>
                                    <label
                                        class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 cursor-pointer transition">
                                        <input type="checkbox" name="challenges" value="egitim"
                                            class="w-4 h-4 rounded text-mlab-cyan focus:ring-mlab-cyan/50">
                                        <span class="text-sm text-slate-700">Eğitimli Nesiller</span>
                                    </label>
                                    <label
                                        class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 cursor-pointer transition">
                                        <input type="checkbox" name="challenges" value="is"
                                            class="w-4 h-4 rounded text-mlab-cyan focus:ring-mlab-cyan/50">
                                        <span class="text-sm text-slate-700">İnsana Yakışır İş</span>
                                    </label>
                                    <label
                                        class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 cursor-pointer transition">
                                        <input type="checkbox" name="challenges" value="inovasyon"
                                            class="w-4 h-4 rounded text-mlab-cyan focus:ring-mlab-cyan/50">
                                        <span class="text-sm text-slate-700">İnovasyon Üretimi</span>
                                    </label>
                                    <label
                                        class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 cursor-pointer transition">
                                        <input type="checkbox" name="challenges" value="kultur"
                                            class="w-4 h-4 rounded text-mlab-cyan focus:ring-mlab-cyan/50">
                                        <span class="text-sm text-slate-700">Kültür ve Kapsayıcılık</span>
                                    </label>
                                    <label
                                        class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 cursor-pointer transition">
                                        <input type="checkbox" name="challenges" value="dongusal"
                                            class="w-4 h-4 rounded text-mlab-cyan focus:ring-mlab-cyan/50">
                                        <span class="text-sm text-slate-700">Döngüsel Metabolizma</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <hr class="border-slate-100">

                        <!-- Contact Person -->
                        <div class="space-y-4">
                            <h3 class="font-semibold text-mlab-navy flex items-center gap-2">
                                <i data-lucide="user" class="w-4 h-4"></i>
                                İletişim Kişisi
                            </h3>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">Ad Soyad *</label>
                                    <input type="text" name="contact_name" required
                                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-slate-800 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-mlab-cyan/50 focus:border-mlab-cyan transition-all">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">Unvan / Pozisyon
                                        *</label>
                                    <input type="text" name="contact_title" required
                                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-slate-800 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-mlab-cyan/50 focus:border-mlab-cyan transition-all">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">E-posta Adresi
                                        *</label>
                                    <input type="email" name="email" required
                                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-slate-800 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-mlab-cyan/50 focus:border-mlab-cyan transition-all">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">Telefon</label>
                                    <input type="tel" name="phone"
                                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-slate-800 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-mlab-cyan/50 focus:border-mlab-cyan transition-all">
                                </div>
                            </div>
                        </div>

                        <hr class="border-slate-100">

                        <!-- Password -->
                        <div class="space-y-4">
                            <h3 class="font-semibold text-mlab-navy flex items-center gap-2">
                                <i data-lucide="lock" class="w-4 h-4"></i>
                                Şifre Oluştur
                            </h3>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">Şifre *</label>
                                    <input type="password" name="password" required minlength="8"
                                        placeholder="En az 8 karakter"
                                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-slate-800 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-mlab-cyan/50 focus:border-mlab-cyan transition-all">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">Şifre Tekrar *</label>
                                    <input type="password" name="password_confirm" required minlength="8"
                                        placeholder="Şifrenizi tekrar girin"
                                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-slate-800 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-mlab-cyan/50 focus:border-mlab-cyan transition-all">
                                </div>
                            </div>
                        </div>

                        <!-- KVKK Consent -->
                        <div class="flex items-start gap-3 bg-slate-50 p-4 rounded-xl">
                            <input type="checkbox" id="kvkk-consent" name="kvkk" required
                                class="w-5 h-5 mt-0.5 rounded border-slate-300 text-mlab-purple focus:ring-mlab-purple/50 cursor-pointer">
                            <label for="kvkk-consent" class="text-sm text-slate-600 leading-relaxed">
                                <a href="yasal.html?page=kvkk" target="_blank"
                                    class="text-mlab-purple font-semibold hover:underline">KVKK Aydınlatma Metni</a>'ni
                                okudum ve kişisel verilerimin işlenmesini kabul ediyorum. *
                            </label>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit"
                            class="w-full bg-gradient-to-r from-mlab-navy to-mlab-purple text-white font-bold py-4 rounded-xl hover:shadow-xl hover:shadow-mlab-purple/20 transition-all duration-300 hover:-translate-y-0.5 flex items-center justify-center gap-2">
                            <i data-lucide="send" class="w-5 h-5"></i>
                            Başvuruyu Gönder
                        </button>

                        <p class="text-center text-sm text-slate-500">
                            Zaten hesabınız var mı?
                            <a href="portal-login" class="text-mlab-purple font-semibold hover:underline">Giriş
                                Yapın</a>
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- SUCCESS MODAL -->
    <div id="success-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 text-center">
                <div
                    class="w-20 h-20 bg-gradient-to-br from-mlab-teal to-mlab-cyan rounded-full flex items-center justify-center mx-auto mb-6">
                    <i data-lucide="check" class="w-10 h-10 text-white"></i>
                </div>
                <h2 class="text-2xl font-bold text-mlab-navy mb-3">Başvurunuz Alındı!</h2>
                <p class="text-slate-600 mb-6">
                    Başvurunuz M-LAB ekibi tarafından incelenecektir. Onay sonrası e-posta ile bilgilendirileceksiniz.
                    Bu işlem genellikle 1-2 iş günü sürmektedir.
                </p>
                <a href="portal"
                    class="inline-flex items-center gap-2 px-6 py-3 bg-mlab-navy text-white font-semibold rounded-xl hover:bg-mlab-purple transition-colors">
                    <i data-lucide="home" class="w-4 h-4"></i>
                    Portal'a Dön
                </a>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="bg-mlab-navy text-white mt-auto">
        <div class="h-1 w-full bg-gradient-to-r from-mlab-cyan via-mlab-purple to-mlab-cyan"></div>
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex flex-col lg:flex-row items-center justify-between gap-6">
                <div class="flex flex-wrap items-center justify-center gap-3 text-xs text-slate-500">
                    <a href="yasal.html?page=privacy" class="hover:text-slate-300 transition-colors">Gizlilik
                        Politikası</a>
                    <span class="text-slate-700">•</span>
                    <a href="yasal.html?page=kvkk" class="hover:text-slate-300 transition-colors">KVKK</a>
                </div>
                <div class="coin-flip-container">
                    <img src="label-circle.png" alt="EU Mission Label"
                        class="h-16 w-auto drop-shadow-lg coin-flip cursor-pointer">
                </div>
                <span class="text-xs text-slate-500">&copy; 2025 M-LAB İzmir</span>
            </div>
        </div>
    </footer>

    <script src="firebase-config.js"></script>
    <script>
        lucide.createIcons();

        document.getElementById('mobile-menu-btn')?.addEventListener('click', () => {
            document.getElementById('mobile-menu')?.classList.toggle('hidden');
        });

        // Loading state
        let isSubmitting = false;

        function showError(message) {
            alert(message);
        }

        function setLoading(loading) {
            isSubmitting = loading;
            const btn = document.querySelector('button[type="submit"]');
            if (loading) {
                btn.disabled = true;
                btn.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> Gönderiliyor...';
            } else {
                btn.disabled = false;
                btn.innerHTML = '<i data-lucide="send" class="w-5 h-5"></i> Başvuruyu Gönder';
            }
            lucide.createIcons();
        }

        // Form submission with Firebase
        document.getElementById('register-form').addEventListener('submit', async function (e) {
            e.preventDefault();
            if (isSubmitting) return;

            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            // Validate passwords match
            if (data.password !== data.password_confirm) {
                showError('Şifreler eşleşmiyor!');
                return;
            }

            if (data.password.length < 8) {
                showError('Şifre en az 8 karakter olmalıdır!');
                return;
            }

            setLoading(true);

            try {
                // Initialize Firebase
                const firebaseReady = await window.firebaseHelpers.initializeFirebase();

                if (!firebaseReady) {
                    // Fallback to localStorage if Firebase not configured
                    console.warn('Firebase yapılandırılmamış, localStorage kullanılıyor...');
                    const pendingUsers = JSON.parse(localStorage.getItem('portal_pending_users') || '[]');
                    data.id = Date.now();
                    data.status = 'pending';
                    data.created_at = new Date().toISOString();
                    delete data.password_confirm;
                    pendingUsers.push(data);
                    localStorage.setItem('portal_pending_users', JSON.stringify(pendingUsers));
                    document.getElementById('success-modal').classList.remove('hidden');
                    setLoading(false);
                    return;
                }

                const { auth, createUserWithEmailAndPassword, sendEmailVerification } = window.firebaseAuth;
                const { db, doc, setDoc, serverTimestamp } = window.firebaseDb;

                // Create user in Firebase Auth
                const userCredential = await createUserWithEmailAndPassword(auth, data.email, data.password);
                const user = userCredential.user;

                // Send email verification
                try {
                    await sendEmailVerification(user);
                } catch (emailError) {
                    console.warn('E-posta doğrulama gönderilemedi:', emailError);
                }

                // Get selected challenges
                const selectedChallenges = Array.from(document.querySelectorAll('input[name="challenges"]:checked'))
                    .map(cb => cb.value);

                if (selectedChallenges.length === 0) {
                    showError('Lütfen en az bir Büyük Zorluk seçiniz!');
                    setLoading(false);
                    return;
                }

                // Create user profile in Firestore
                const userProfile = {
                    email: data.email,
                    org_name: data.org_name,
                    org_type: data.category,
                    challenges: selectedChallenges,
                    description: data.org_description || '',
                    website: data.website || '',
                    contact_name: data.contact_name,
                    contact_title: data.contact_title,
                    phone: data.phone || '',
                    status: 'pending',
                    created_at: serverTimestamp(),
                    approved_at: null,
                    approved_by: null
                };

                await setDoc(doc(db, 'users', user.uid), userProfile);

                // Sign out after registration (user needs approval)
                await window.firebaseAuth.signOut(auth);

                // Show success modal
                document.getElementById('success-modal').classList.remove('hidden');

            } catch (error) {
                console.error('Kayıt hatası:', error);

                let errorMessage = 'Kayıt sırasında bir hata oluştu.';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Bu e-posta adresi zaten kayıtlı.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Şifre çok zayıf. Lütfen daha güçlü bir şifre seçin.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Geçersiz e-posta adresi.';
                }

                showError(errorMessage);
            } finally {
                setLoading(false);
            }
        });
    </script>
</body>

</html>